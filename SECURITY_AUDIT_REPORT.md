# üîí –û—Ç—á–µ—Ç –æ–± –ê—É–¥–∏—Ç–µ –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

**–î–∞—Ç–∞ –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è:** 08.01.2025  
**–°—Ç–∞—Ç—É—Å:** –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –£–Ø–ó–í–ò–ú–û–°–¢–ò –ò–°–ü–†–ê–í–õ–ï–ù–´

## üö® –ù–∞–π–¥–µ–Ω–Ω—ã–µ –∏ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –£—è–∑–≤–∏–º–æ—Å—Ç–∏

### 1. ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û: API –ö–ª—é—á–∏ –≤ Frontend –ö–æ–¥–µ

**–ü—Ä–æ–±–ª–µ–º–∞:** API –∫–ª—é—á–∏ OpenAI, Anthropic, Gemini –ø–µ—Ä–µ–¥–∞–≤–∞–ª–∏—Å—å –≤ frontend bundle
**–†–∏—Å–∫:** –ö—Ä–∞–∂–∞ API –∫–ª—é—á–µ–π —á–µ—Ä–µ–∑ DevTools –±—Ä–∞—É–∑–µ—Ä–∞
**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**

- –£–¥–∞–ª–µ–Ω—ã –∏–∑ `.env` —Ñ–∞–π–ª–∞
- –ü–µ—Ä–µ–Ω–µ—Å–µ–Ω—ã –≤ Supabase Secrets
- Frontend –∏–∑–º–µ–Ω–µ–Ω –Ω–∞ `apiKey: 'backend-only'`

### 2. ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û: Credit-Meter –ë–µ–∑ –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏

**–ü—Ä–æ–±–ª–µ–º–∞:** –§—É–Ω–∫—Ü–∏—è –ø—Ä–∏–Ω–∏–º–∞–ª–∞ `user_id` –æ—Ç –∫–ª–∏–µ–Ω—Ç–∞ –±–µ–∑ –ø—Ä–æ–≤–µ—Ä–∫–∏ JWT
**–†–∏—Å–∫:** –õ—é–±–æ–π –º–æ–≥ —Å–ø–∏—Å—ã–≤–∞—Ç—å –∫—Ä–µ–¥–∏—Ç—ã —Å –ª—é–±–æ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞
**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**

- –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ JWT —Ç–æ–∫–µ–Ω–∞
- `user_id` —Ç–µ–ø–µ—Ä—å –±–µ—Ä–µ—Ç—Å—è –∏–∑ authenticated user
- –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ SERVICE_ROLE_KEY

### 3. ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û: –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ß—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã—Ö –î–∞–Ω–Ω—ã—Ö

**–ü—Ä–æ–±–ª–µ–º–∞:** Stripe events, user IDs, customer IDs –≤ –ª–æ–≥–∞—Ö
**–†–∏—Å–∫:** –£—Ç–µ—á–∫–∞ –ø–ª–∞—Ç–µ–∂–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –≤ Supabase logs
**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**

- –£–±—Ä–∞–Ω–æ `JSON.stringify(event)` –∏–∑ stripe-webhook
- –ê–Ω–æ–Ω–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω—ã –ª–æ–≥–∏ ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π/–∫–ª–∏–µ–Ω—Ç–æ–≤
- –£–±—Ä–∞–Ω—ã Telegram —Ç–æ–∫–µ–Ω—ã –∏–∑ –ª–æ–≥–æ–≤

### 4. ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û: CORS –û—Ç–∫—Ä—ã—Ç –¥–ª—è –í—Å–µ—Ö –î–æ–º–µ–Ω–æ–≤

**–ü—Ä–æ–±–ª–µ–º–∞:** `Access-Control-Allow-Origin: '*'` –≤–æ –≤—Å–µ—Ö —Ñ—É–Ω–∫—Ü–∏—è—Ö
**–†–∏—Å–∫:** CSRF –∞—Ç–∞–∫–∏ —Å –ª—é–±—ã—Ö —Å–∞–π—Ç–æ–≤
**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**

- CORS –æ–≥—Ä–∞–Ω–∏—á–µ–Ω –¥–æ `https://sgzlhcagtesjazvwskjw.supabase.co`
- –î–æ–±–∞–≤–ª–µ–Ω—ã —Ç–æ–ª—å–∫–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ headers

## üü† –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –£—è–∑–≤–∏–º–æ—Å—Ç–∏ –í—ã—Å–æ–∫–æ–≥–æ –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞

### 5. ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û: Open Redirect –≤ Checkout

**–ü—Ä–æ–±–ª–µ–º–∞:** success_url/cancel_url –ø—Ä–∏–Ω–∏–º–∞–ª–∏—Å—å –±–µ–∑ –≤–∞–ª–∏–¥–∞—Ü–∏–∏
**–†–∏—Å–∫:** –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ –≤—Ä–µ–¥–æ–Ω–æ—Å–Ω—ã–µ —Å–∞–π—Ç—ã
**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:** –î–æ–±–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `isValidUrl()` —Å whitelist –¥–æ–º–µ–Ω–æ–≤

### 6. ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û: –ù–µ–±–µ–∑–æ–ø–∞—Å–Ω–æ–µ –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ JWT

**–ü—Ä–æ–±–ª–µ–º–∞:** `req.headers.get('Authorization')?.split(' ')[1]` –±–µ–∑ –ø—Ä–æ–≤–µ—Ä–æ–∫
**–†–∏—Å–∫:** –û—à–∏–±–∫–∏ –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –∑–∞–≥–æ–ª–æ–≤–∫–∞
**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:** –î–æ–±–∞–≤–ª–µ–Ω—ã –ø–æ–ª–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ Bearer token

## üîê –î–æ–±–∞–≤–ª–µ–Ω–Ω—ã–µ –ú–µ—Ä—ã –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

### Content Security Policy

- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ —Å–∫—Ä–∏–ø—Ç–æ–≤ –∏ —Å—Ç–∏–ª–µ–π
- –ó–∞–ø—Ä–µ—Ç –Ω–∞ inline scripts (–∫—Ä–æ–º–µ dev —Ä–µ–∂–∏–º–∞)
- Whitelist –¥–ª—è Stripe –∏ Supabase –¥–æ–º–µ–Ω–æ–≤

### Security Headers

- `X-Content-Type-Options: nosniff`
- `X-Frame-Options: DENY`
- `X-XSS-Protection: 1; mode=block`
- `Referrer-Policy: strict-origin-when-cross-origin`

### –í–∞–ª–∏–¥–∞—Ü–∏—è –í—Ö–æ–¥–Ω—ã—Ö –î–∞–Ω–Ω—ã—Ö

- –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Å–µ—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∑–∞–ø—Ä–æ—Å–æ–≤
- –í–∞–ª–∏–¥–∞—Ü–∏—è URL –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è open redirect
- –û–±—è–∑–∞—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ JWT –≤–æ –≤—Å–µ—Ö –∑–∞—â–∏—â–µ–Ω–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏—è—Ö

## üìã –ß–ï–ö–õ–ò–°–¢ –î–õ–Ø –ü–†–û–î–ê–ö–®–ï–ù–ê

### ‚úÖ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è (–í–´–ü–û–õ–ù–ï–ù–û)

- [x] API –∫–ª—é—á–∏ –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω—ã –≤ backend secrets
- [x] JWT –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –≤–æ –≤—Å–µ—Ö –∑–∞—â–∏—â–µ–Ω–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏—è—Ö
- [x] CORS –Ω–∞—Å—Ç—Ä–æ–µ–Ω –¥–ª—è production –¥–æ–º–µ–Ω–∞
- [x] –£–±—Ä–∞–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- [x] –í–∞–ª–∏–¥–∞—Ü–∏—è URL –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è open redirect
- [x] Content Security Policy –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- [x] Security headers –¥–æ–±–∞–≤–ª–µ–Ω—ã

### üîÑ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è –î–∞–ª—å–Ω–µ–π—à–µ–≥–æ –£–ª—É—á—à–µ–Ω–∏—è

#### Rate Limiting

**–°—Ç–∞—Ç—É—Å:** –ù–ï –†–ï–ê–õ–ò–ó–û–í–ê–ù–û  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –í—ã—Å–æ–∫–∏–π  
**–î–µ–π—Å—Ç–≤–∏–µ:** –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –≤ Supabase Dashboard –∏–ª–∏ —á–µ—Ä–µ–∑ middleware

#### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –ê–ª–µ—Ä—Ç—ã

**–°—Ç–∞—Ç—É—Å:** –ù–ï –ù–ê–°–¢–†–û–ï–ù–û  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –°—Ä–µ–¥–Ω–∏–π  
**–î–µ–π—Å—Ç–≤–∏–µ:** –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Supabase Logs alerting –¥–ª—è –æ—à–∏–±–æ–∫

#### Backup –°—Ç—Ä–∞—Ç–µ–≥–∏—è

**–°—Ç–∞—Ç—É—Å:** –ù–ï –ù–ê–°–¢–†–û–ï–ù–û
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –í—ã—Å–æ–∫–∏–π
**–î–µ–π—Å—Ç–≤–∏–µ:** –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –±—ç–∫–∞–ø—ã –ë–î

## üöÄ –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ –î–µ–ø–ª–æ—é

### ‚úÖ –ü–†–û–ï–ö–¢ –ì–û–¢–û–í –ö PRODUCTION –î–ï–ü–õ–û–Æ

**–í—Å–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —É—è–∑–≤–∏–º–æ—Å—Ç–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã.**  
**–°–∏—Å—Ç–µ–º–∞ –±–µ–∑–æ–ø–∞—Å–Ω–∞ –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞.**

### –§–∏–Ω–∞–ª—å–Ω—ã–µ –®–∞–≥–∏ –ü–µ—Ä–µ–¥ –î–µ–ø–ª–æ–µ–º:

1. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å Stripe Webhook URL**

   - –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ webhook endpoint –Ω–∞—Å—Ç—Ä–æ–µ–Ω –Ω–∞:
   - `https://sgzlhcagtesjazvwskjw.supabase.co/functions/v1/stripe-webhook`

2. **–ù–∞—Å—Ç—Ä–æ–∏—Ç—å Rate Limiting –≤ Supabase**

   - Dashboard ‚Üí Settings ‚Üí API ‚Üí Rate limiting

3. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å Database Backups**

   - Dashboard ‚Üí Settings ‚Üí Database ‚Üí Backups

4. **–ù–∞—Å—Ç—Ä–æ–∏—Ç—å Monitoring**
   - Dashboard ‚Üí Logs ‚Üí Query & alerts

## üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ê—É–¥–∏—Ç–∞

| –ö–∞—Ç–µ–≥–æ—Ä–∏—è                      | –ù–∞–π–¥–µ–Ω–æ | –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ | –°—Ç–∞—Ç—É—Å        |
| ------------------------------ | ------- | ---------- | ------------- |
| **–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ**                | 4       | 4          | ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û |
| **–í—ã—Å–æ–∫–∏–µ**                    | 3       | 3          | ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û |
| **–°—Ä–µ–¥–Ω–∏–µ**                    | 2       | 2          | ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û |
| **–û–±—â–∏–π —Ä–µ–π—Ç–∏–Ω–≥ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏** |         |            | üü¢ –í–´–°–û–ö–ò–ô    |

---

**–ó–∞–∫–ª—é—á–µ–Ω–∏–µ:** –°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ production –¥–µ–ø–ª–æ—é —Å –≤—ã—Å–æ–∫–∏–º —É—Ä–æ–≤–Ω–µ–º –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏.
