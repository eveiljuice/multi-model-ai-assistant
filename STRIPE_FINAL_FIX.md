# ‚úÖ –§–∏–Ω–∞–ª—å–Ω–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ Stripe

## –ü—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è

### 1. ‚ùå "invalid session token" - Edge Function
**–†–µ—à–µ–Ω–∏–µ**: –í—Ä–µ–º–µ–Ω–Ω–æ –æ—Ç–∫–ª—é—á–µ–Ω–∞, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è fallback –Ω–∞ Express

### 2. ‚ùå "body stream already read" - –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–≤–µ—Ç–æ–≤  
**–†–µ—à–µ–Ω–∏–µ**: ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –∫–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ response –æ–±—ä–µ–∫—Ç–∞

### 3. ‚ùå "500 Internal Server Error" - Vite proxy –Ω–µ —Ä–∞–±–æ—Ç–∞–ª
**–†–µ—à–µ–Ω–∏–µ**: ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ –ø—Ä—è–º–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Express —Å–µ—Ä–≤–µ—Ä—É

### 4. ‚úÖ Express —Å–µ—Ä–≤–µ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ
**–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ**: –°–æ–∑–¥–∞–µ—Ç live —Å–µ—Å—Å–∏–∏ Stripe —É—Å–ø–µ—à–Ω–æ

## üöÄ –ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å–µ–π—á–∞—Å

‚úÖ Express —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω –Ω–∞ –ø–æ—Ä—Ç—É 3002  
‚úÖ Stripe live –∫–ª—é—á–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã  
‚úÖ –ü—Ä–æ–¥—É–∫—Ç—ã —Å—É—â–µ—Å—Ç–≤—É—é—Ç –≤ Stripe  
‚úÖ –°–µ—Ä–≤–µ—Ä —Å–æ–∑–¥–∞–µ—Ç checkout —Å–µ—Å—Å–∏–∏  
‚úÖ –§—Ä–æ–Ω—Ç–µ–Ω–¥ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø—Ä—è–º–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Express  

## üìã –®–∞–≥–∏ –¥–ª—è –∑–∞–ø—É—Å–∫–∞

### 1. –ó–∞–ø—É—Å–∫ Express —Å–µ—Ä–≤–µ—Ä–∞  
```bash
cd server
node server.js
```
–î–æ–ª–∂–Ω–æ –ø–æ—è–≤–∏—Ç—å—Å—è:
```
üöÄ Stripe server running on port 3002
üìä Health check: http://localhost:3002/health
üîë Stripe key configured: true
```

### 2. –ó–∞–ø—É—Å–∫ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞
```bash
npm run dev
```

### 3. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- –û—Ç–∫—Ä–æ–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ
- –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É Pricing
- –í—ã–±–µ—Ä–∏—Ç–µ –ª—é–±–æ–π –ø–∞–∫–µ—Ç –¥–ª—è –ø–æ–∫—É–ø–∫–∏
- –í –∫–æ–Ω—Å–æ–ª–∏ –¥–æ–ª–∂–Ω–æ –ø–æ—è–≤–∏—Ç—å—Å—è:
  - "‚ö†Ô∏è Using Express server fallback"
  - "üåê Using API URL: http://localhost:3002/api/stripe/create-checkout-session"
  - "‚úÖ Checkout session created via Express server"

## üîß –ö–ª—é—á–µ–≤—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### `src/services/stripe.service.ts`
1. **–ü—Ä—è–º–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Express**: –û–±—Ö–æ–¥ –ø—Ä–æ–±–ª–µ–º Vite proxy
2. **–£–ª—É—á—à–µ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫**: –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ –∫–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ response
3. **–ü–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**: –î–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –ø—Ä–æ–±–ª–µ–º
4. **Fallback —Å–∏—Å—Ç–µ–º–∞**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –æ—Ç–∫–∞—Ç —Å Edge Function –Ω–∞ Express

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π
```
Frontend (React)
    ‚Üì
Direct HTTP call to localhost:3002
    ‚Üì  
Express Server (port 3002)
    ‚Üì
Stripe API (Live keys)
```

## üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç
- ‚úÖ Stripe –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–∞
- ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ checkout —Å–µ—Å—Å–∏–π —Ä–∞–±–æ—Ç–∞–µ—Ç  
- ‚úÖ –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ Stripe Checkout —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ live –ø—Ä–æ–¥—É–∫—Ç–æ–≤ Stripe

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

1. **Live –∫–ª—é—á–∏**: –í –ø—Ä–æ–µ–∫—Ç–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è live –∫–ª—é—á–∏ Stripe - —ç—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç —Ä–µ–∞–ª—å–Ω—ã–µ –ø–ª–∞—Ç–µ–∂–∏
2. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**: –î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ª—É—á—à–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å test –∫–ª—é—á–∏  
3. **Edge Function**: –ü–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Supabase secrets –º–æ–∂–Ω–æ –≤–∫–ª—é—á–∏—Ç—å –æ–±—Ä–∞—Ç–Ω–æ

## üîÑ –í–∫–ª—é—á–µ–Ω–∏–µ Edge Function (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

–ü–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Supabase secrets:
```bash
npx supabase secrets set STRIPE_PUBLIC_KEY=pk_live_...
npx supabase secrets set STRIPE_SECRET_KEY=sk_live_...
npx supabase functions deploy stripe-checkout-v4
```

–ó–∞—Ç–µ–º –≤ `stripe.service.ts` —Ä–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—É—é –ª–æ–≥–∏–∫—É:
```typescript
// –í–µ—Ä–Ω—É—Ç—å –æ–±—Ä–∞—Ç–Ω–æ try-catch –ª–æ–≥–∏–∫—É —Å Edge Function
```

–°–∏—Å—Ç–µ–º–∞ Stripe —Ç–µ–ø–µ—Ä—å –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–∞! üéâ