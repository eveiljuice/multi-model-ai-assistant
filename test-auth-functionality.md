# Тестирование Функционала Авторизации для Неавторизованных Пользователей

## Описание Функционала

Реализован функционал, который позволяет неавторизованным пользователям видеть карточки агентов, но при попытке начать чат показывает модальное окно авторизации.

## Тестовые Сценарии

### 1. Неавторизованный пользователь

- Открыть приложение без авторизации
- Убедиться, что видны карточки агентов
- Нажать на кнопку "Open Chat" на любой карточке
- Убедиться, что открывается модальное окно авторизации
- Попытаться закрыть модальное окно и снова нажать "Open Chat"
- Убедиться, что модальное окно снова открывается

### 2. Регистрация нового пользователя

- Нажать "Open Chat" на карточке агента
- В модальном окне авторизации перейти на вкладку "Create Account"
- Заполнить форму регистрации
- Убедиться, что после успешной регистрации модальное окно закрывается
- Убедиться, что открывается чат с выбранным агентом

### 3. Авторизация существующего пользователя

- Нажать "Open Chat" на карточке агента
- В модальном окне авторизации ввести существующие данные
- Убедиться, что после успешной авторизации модальное окно закрывается
- Убедиться, что открывается чат с выбранным агентом

### 4. Авторизованный пользователь

- Авторизоваться в системе
- Убедиться, что карточки агентов отображают статус кредитов
- Нажать "Open Chat" на карточке агента
- Убедиться, что чат открывается без модального окна авторизации
- Убедиться, что при недостатке кредитов показывается кнопка "Get Credits"

### 5. Безопасность

- Убедиться, что модальное окно авторизации нельзя обойти
- Убедиться, что без авторизации невозможно отправить сообщение
- Убедиться, что сессия корректно сохраняется после авторизации

## Ожидаемые Результаты

1. **Неавторизованные пользователи** видят карточки агентов с кнопкой "Open Chat"
2. **Клик на "Open Chat"** без авторизации показывает модальное окно авторизации
3. **Модальное окно** нельзя обойти - оно появляется при каждой попытке
4. **После авторизации** пользователь может продолжить использование выбранного агента
5. **Авторизованные пользователи** могут сразу открывать чат (если есть кредиты)
6. **UX плавный** - пользователь не теряет контекст выбранного агента

## Проверка Логирования

В консоли разработчика должны появляться следующие логи:

- `auth_required_for_chat` - при попытке открыть чат без авторизации
- `auth_modal_closed` - при закрытии модального окна
- `agent_selected_after_auth` - при успешной авторизации и продолжении работы
- `minimized_chat_restored_after_auth` - при восстановлении минимизированного чата после авторизации

## Дополнительные Проверки

1. **Мобильная версия** - функционал работает на мобильных устройствах
2. **Обновление страницы** - состояние сохраняется корректно
3. **Навигация** - переходы между страницами не нарушают логику
4. **Производительность** - модальные окна открываются быстро

## Устранение Проблем

Если что-то не работает:

1. **Проверить консоль** на наличие ошибок JavaScript
2. **Очистить localStorage** и cookies браузера
3. **Перезагрузить страницу** для сброса состояния
4. **Проверить сетевые запросы** в DevTools
5. **Убедиться, что Supabase** работает корректно

## Код для Тестирования

```javascript
// Тестирование в консоли браузера
console.log("User:", localStorage.getItem("supabase.auth.token"));
console.log("Auth Context:", window.authContext);

// Очистка состояния для тестирования
localStorage.clear();
sessionStorage.clear();
window.location.reload();
```
