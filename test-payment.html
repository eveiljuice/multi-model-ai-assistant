<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>–¢–µ—Å—Ç–æ–≤–∞—è –æ–ø–ª–∞—Ç–∞ Stripe</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        max-width: 800px;
        margin: 50px auto;
        padding: 20px;
        background: #f5f5f5;
      }
      .container {
        background: white;
        padding: 30px;
        border-radius: 10px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }
      .payment-link {
        display: inline-block;
        background: #635bff;
        color: white;
        padding: 15px 30px;
        text-decoration: none;
        border-radius: 5px;
        font-weight: bold;
        margin: 10px 5px;
      }
      .payment-link:hover {
        background: #5a52e5;
      }
      .test-info {
        background: #e3f2fd;
        padding: 20px;
        border-radius: 5px;
        margin: 20px 0;
      }
      .step {
        margin: 15px 0;
        padding: 10px;
        border-left: 4px solid #2196f3;
        background: #f8f9fa;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ Stripe –ø–ª–∞—Ç–µ–∂–µ–π</h1>
      <p>–ü—Ä–æ–≤–µ—Ä—è–µ–º –æ—Ç–ø—Ä–∞–≤–∫—É Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –ø—Ä–∏ —É—Å–ø–µ—à–Ω–æ–π –æ–ø–ª–∞—Ç–µ.</p>

      <div class="test-info">
        <h3>üìù –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –∫–∞—Ä—Ç—ã:</h3>
        <ul>
          <li><strong>–ù–æ–º–µ—Ä –∫–∞—Ä—Ç—ã:</strong> 4242 4242 4242 4242</li>
          <li>
            <strong>–°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è:</strong> –ª—é–±–∞—è –±—É–¥—É—â–∞—è –¥–∞—Ç–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä: 12/25)
          </li>
          <li><strong>CVC:</strong> –ª—é–±–æ–π 3-–∑–Ω–∞—á–Ω—ã–π –∫–æ–¥ (–Ω–∞–ø—Ä–∏–º–µ—Ä: 123)</li>
          <li><strong>–ü–æ—á—Ç–æ–≤—ã–π –∏–Ω–¥–µ–∫—Å:</strong> –ª—é–±–æ–π (–Ω–∞–ø—Ä–∏–º–µ—Ä: 12345)</li>
        </ul>
      </div>

      <h3>–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø —Ç–µ—Å—Ç–æ–≤–æ–π –æ–ø–ª–∞—Ç—ã:</h3>

      <div>
        <button onclick="createPayment()" class="payment-link">
          üí≥ –†–∞–∑–æ–≤–∞—è –æ–ø–ª–∞—Ç–∞ ($1.00)
        </button>

        <button onclick="createSubscription()" class="payment-link">
          üîÑ –ü–æ–¥–ø–∏—Å–∫–∞ ($1.00/–º–µ—Å—è—Ü)
        </button>
      </div>

      <div id="result" style="margin-top: 20px"></div>

      <div class="step">
        <h4>üìã –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é:</h4>
        <ol>
          <li>–ù–∞–∂–º–∏—Ç–µ –æ–¥–Ω—É –∏–∑ –∫–Ω–æ–ø–æ–∫ –≤—ã—à–µ</li>
          <li>–û—Ç–∫—Ä–æ–µ—Ç—Å—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ Stripe Checkout</li>
          <li>–í–≤–µ–¥–∏—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –∫–∞—Ä—Ç—ã</li>
          <li>–ó–∞–≤–µ—Ä—à–∏—Ç–µ –æ–ø–ª–∞—Ç—É</li>
          <li>–ü—Ä–æ–≤–µ—Ä—å—Ç–µ Telegram —á–∞—Ç –Ω–∞ –Ω–∞–ª–∏—á–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</li>
        </ol>
      </div>
    </div>

    <script>
      async function createPayment() {
        document.getElementById("result").innerHTML =
          "‚è≥ –°–æ–∑–¥–∞–µ–º —Ç–µ—Å—Ç–æ–≤—É—é –æ–ø–ª–∞—Ç—É...";

        try {
          const response = await fetch(
            "/server/server.js" ||
              "http://localhost:3002/api/stripe/create-checkout-session",
            {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify({
                priceId: "price_test_123", // –í—Ä–µ–º–µ–Ω–Ω—ã–π ID
                mode: "payment",
                successUrl: window.location.origin + "/success.html",
                cancelUrl: window.location.origin + "/test-payment.html",
                customerEmail: "test@donein5.com",
                userId: "test-user-123",
                credits: 10,
              }),
            }
          );

          const data = await response.json();
          if (data.url) {
            window.location.href = data.url;
          } else {
            document.getElementById("result").innerHTML =
              "‚ùå –û—à–∏–±–∫–∞: " + (data.error || "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞");
          }
        } catch (error) {
          // Fallback - –∏—Å–ø–æ–ª—å–∑—É–µ–º –ø—Ä–µ–¥—Å–æ–∑–¥–∞–Ω–Ω—É—é —Å—Å—ã–ª–∫—É
          window.open(
            "https://checkout.stripe.com/c/pay/cs_live_a1C9ApuVi62f4HGugGqMPVtxyAVhw3ZrD7KzRiYBg1n8MdWS6JL6mQC1Fv#fidkdWxOYHwnPyd1blppbHNgWjA0TnQ9SH1ETjJTMWgyNmRpZnZKPFRzZjY9fX90bk1iZlM8cl9dSWhyUU9yMDJ8V1w1V3BucFxOUWdrPTc9f05zfDZ8QVY3a0lvVEdPalJQdlw3VjAzbnF1NTV2f1R2SEBWaicpJ2N3amhWYHdzYHcnP3F3cGApJ2lkfGpwcVF8dWAnPyd2bGtiaWBabHFgaCcpJ2BrZGdpYFVpZGZgbWppYWB3dic%2FcXdwYHgl",
            "_blank"
          );
          document.getElementById("result").innerHTML =
            "‚úÖ –û—Ç–∫—Ä—ã—Ç–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –æ–ø–ª–∞—Ç—ã –≤ –Ω–æ–≤–æ–π –≤–∫–ª–∞–¥–∫–µ";
        }
      }

      async function createSubscription() {
        document.getElementById("result").innerHTML =
          "‚è≥ –°–æ–∑–¥–∞–µ–º —Ç–µ—Å—Ç–æ–≤—É—é –ø–æ–¥–ø–∏—Å–∫—É...";

        try {
          const response = await fetch(
            "http://localhost:3002/api/stripe/create-checkout-session",
            {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify({
                priceId: "price_1RiUt0AK7V4m73aluYckgD6P", // –°—É—â–µ—Å—Ç–≤—É—é—â–∞—è –ø–æ–¥–ø–∏—Å–∫–∞
                mode: "subscription",
                successUrl: window.location.origin + "/success.html",
                cancelUrl: window.location.origin + "/test-payment.html",
                customerEmail: "test-subscription@donein5.com",
                userId: "test-sub-user-456",
                credits: 250,
              }),
            }
          );

          const data = await response.json();
          if (data.url) {
            window.location.href = data.url;
          } else {
            document.getElementById("result").innerHTML =
              "‚ùå –û—à–∏–±–∫–∞: " + (data.error || "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞");
          }
        } catch (error) {
          document.getElementById("result").innerHTML =
            "‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —Å–µ—Ä–≤–µ—Ä—É: " + error.message;
        }
      }
    </script>
  </body>
</html>
